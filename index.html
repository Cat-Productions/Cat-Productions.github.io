<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Image</title>
</head>
<body>
    <h1>Random Image from Current Directory</h1>
    <img id="random-image" src="" alt="Random Image" width="600" height="auto">
    <script>
        // GitHub API URL to list files in the "images" folder
        const owner = "Cat-Productions";  // Replace with your GitHub username
        const repo = "Cat-Productions.github.io";  // Replace with your repository name
        const folder = "images";  // Folder containing your images
        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;

        // Variable to store the list of image files
        let imageFiles = [];
        let lastUpdated = 0;  // Timestamp of last update

        // Check if there is a cached list of images in localStorage
        function loadFromCache() {
            const cachedData = localStorage.getItem("imageCache");
            if (cachedData) {
                const data = JSON.parse(cachedData);
                imageFiles = data.imageFiles;
                lastUpdated = data.lastUpdated;
            }
        }

        // Save the image list to localStorage
        function saveToCache() {
            const data = {
                imageFiles: imageFiles,
                lastUpdated: Date.now(),
            };
            localStorage.setItem("imageCache", JSON.stringify(data));
        }

        // Function to fetch the list of images from GitHub API
        function fetchImageList() {
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    // Filter the response to get image files (e.g., .jpg, .png)
                    imageFiles = data.filter(file => file.name.match(/\.(jpg|jpeg|png)$/));

                    // Save the updated list to localStorage
                    saveToCache();
                    console.log('Image list updated from GitHub');
                })
                .catch(error => console.error('Error fetching images:', error));  // Handle errors
        }

        // Function to display a random image
        function displayRandomImage() {
            // Check if the cache is fresh (within the last 60 seconds)
            if (imageFiles.length === 0 || Date.now() - lastUpdated > 60000) {
                fetchImageList();  // Fetch the image list from GitHub if it's time to update
            }

            // If there are images, pick a random one
            if (imageFiles.length > 0) {
                const randomImage = imageFiles[Math.floor(Math.random() * imageFiles.length)].download_url;
                document.getElementById("random-image").src = randomImage;
            } else {
                console.error('No images found');
            }
        }

        // Initialize the image list fetch process
        window.onload = function() {
            loadFromCache();  // Try to load the cached data from localStorage
            displayRandomImage();  // Display the first random image

            // Refresh the image list every 60 seconds if needed
            setInterval(() => {
                if (Date.now() - lastUpdated > 60000) {
                    fetchImageList();  // Update image list if it's time
                }
            }, 60000);
        };

    </script>
</body>
</html>
